<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5267Z24Q15"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-5267Z24Q15');
    </script>
    <!--TESTING EXCEL DOWNLOAD-->
    <script lang="javascript" src="js/xlsx.full.min.js"></script>
    <script lang="javascript" src="js/FileSaver.min.js"></script>
    <!--TESTING EXCEL DOWNLOAD-->

    <meta charset="utf-8">
    <title>Map | LA Community Solar Opportunity Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description"
      content="LA Community Solar Opportunity Map is a first-of-its-kind interactive platform for finding community net solar potential in LA County. Produced by the California Center for Sustainable Communities at UCLA.">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
      href="https://fonts.googleapis.com/css2?family=Assistant:wght@800&family=Overpass:ital,wght@0,400;0,700;0,900;1,400;1,700&display=swap"
      rel="stylesheet">
    <link href="css/main_style.css" rel="stylesheet">

  <body>
    <nav id="main-nav" role="navigation">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="methods.html">Methods</a></li>
        <li><a href="tutorial.html">Tutorial</a></li>
        <li><a href="map.html">Solar Map</a></li>
        <li><a href="resources.html">Resources</a></li>
        <li><a href="mailto:ccsc@ioes.ucla.edu">Contact</a></li>
      </ul>
    </nav>

    <header role="banner">
      <h1>Solar Map</h1>
      <div class="tutorial-links">
      <h2>Tutorial Quick Link</h2>
      <p><b>Note</b>: Links go to the <a href="tutorial.html">tutorial page</a>.
      </p>
      <ul>
        <li><a href="tutorial.html#city" role="button">Find sites within my
            city</a></li>
        <li><a href="tutorial.html#cpa" role="button">Find sites within Clean
            Power Alliance Territory</a></li>
        <li><a href="tutorial.html#capacity" role="button">Find sites with
            sufficient circuit capacity</a></li>
        <li><a href="tutorial.html#highest" role="button">Find sites with the
            highest combined potential generation capacity</a></li>
        <li><a href="tutorial.html#dac" role="button">Find sites within DAC
            Census Tracts</a></li>
        <li><a href="tutorial.html#pop" role="button">Find sites with the most
            people</a></li>
        <li><a href="tutorial.html#rent" role="button">Find sites with the most
            renters</a></li>
      </ul>
    </div>
    </header>

    <main role="main">

      <p class="lede">Where are opportunities to install community
        solar?</p>
      <p>Find eligible sites for community
        solar in your city with the map tool below.</p>
      <p>Eligible sites are publicly owned or community oriented institutional
        facilities with existing buildings and parking lots. Panels on the right side of the map help
        filter and narrow locations based on criteria important to your solar
        installation site. LADWP service territory is grayed out because key data inputs about grid
        distribution circuit capacities were unavailable.</p>

      <p>Please note that 100% screen resolution is most ideal for using the map.</p>
      <a href="http://www.caclimateinvestments.ca.gov/" target="_blank">
        <img class="cci_logo" src="./images/CCI_logo_tagline_RGB72.png" alt="CCI logo">
      </a>
      <p><a href="#map" role="button">Scroll to Map</a></p>
      <button onclick="topFunction()" id="topBtn" title="Go to top">Top</button>

      <h1>Get Started:</h1>

      <button class="accordion">Find sites within my city</button>
      <div class="panel">

        <ol>
          <li>There are two ways to focus the map on your city of interest. Use the search
            bar, located in the bottom left corner of the map. Type in your city and hit "Enter." This will
            zoom you into the city of interest and add a red pin.You can also zoom into a city with 
            using the "+/-" zoom tools next to the search bar.</li>
          <li>After zooming to your city, open the City filter. Click "Search in 87 Categories." Type your
            city in the search bar.</li>
          <li> Once it appears in the list, it will be greyed out, click the check box to the left to select.
            Click Apply in the upper-left corner of the filter.</li>
        </ol>
        <p>Now, only eligible sites within your city are shown on the map.
          Other filters will reflect this change. You can now see the
          distribution of other available datasets for sites located only in
          your city. Because filters are added cumulatively, making a
          selection in an additional filter will further refine the selected
          sites.</p>
        <p>To undo your selection, click “Unlock” in the filter.</p>
        <img src="images/sites_by_city.gif">

      </div>

      <button class="accordion">Find sites within Clean Power Alliance (CPA)
        Territory</button>
      <div class="panel">

        <ol>
          <li>Scroll to and open the "CPA Territory" filter.</li>
          <li>Eligible sites are divided into two categories: true where the
            site is located within CPA territory, and false where it is
            outside CPA territory.</li>
          <li>Click "true." Now, only eligible sites within CPA territory are
            shown on the map. Using additional filters will further
            refine your selected sites.</li>
        </ol>
        <p>To undo this step, click "All" within the CPA Territory filter.</p>
        <img src="images/cpa.gif">

      </div>

      <!-- <button class="accordion">Find sites with sufficient circuit capacity</button>
      <div class="panel">

        <ol>
          <li>Scroll to and open the "Sufficient Circuit Capacity" filter.
          </li>
          <li>Eligible sites are divided into two categories: true where the
            site has sufficient grid circuit capacity to accomodate solar PV,
            and false where it does not.
          </li>
          <li>Click "true." Now, only eligible sites with sufficient circuit
            capacity are shown on the map. Using additional filters
            will further refine your selected sites.</li>
        </ol>
        <p>To undo this step, click "All" within the Sufficient Circuit
          Capacity filter.</p>
        <img src="images/capacity.gif"> -->

      </div>

      <button class="accordion">Find sites with the highest Combined Capacity
        Potential (MW)</button>
      <div class="panel">

        <ol>
          <li>Scroll to and open the Combined Solar Potential (MW) filter.
          </li>
          <li>A histogram shows the distribution of combined solar
            potential (MW) in each eligible site shown on the map. Combined 
            solar potential represents the combination of rooftop and parking
            lot solar potential (MW).</li>
          <li>Click on the histogram and two range bars appear. Drag the bars
            to capture the highest range of values or the values you are most
            interested in.</li>
          <li>Now, only eligible sites with a combined capacity potential
            within the range you have set in the histogram are available.
            Using additional filters will further refine your
            selected sites.</li>
        </ol>
        <p>To undo this step, click "Clear" within the Combined Capacity
          Potential filter. To see a histogram of just your selected values,
          click "Zoom."</p>
        <img src="images/highest.gif">

      </div>

      <button class="accordion">Find sites within DAC census tracts</button>
      <div class="panel">

        <ol>
          <li>Go to the legend on the left side of the map. Click the check
            box next to "DAC Census Tracts." This layer is provided as an
            overview of the DAC Census Tracts in Los Angeles County.</li>
          <li>Scroll to and open the "CalEnviroscreen 3.0 Scores" filter. This
            histogram filters eligible sites based on the CalEnviroscreen score
            of the census tract it is located within.</li>
          <li>Click the histogram and two range bars appear. Drag the bars to
            capture the eligible sites with a CalEnviroscreen score between 75
            and 100. The eligible sites now overlap with the DAC Census Tract
            layer available in the legend.</li>
          <li>Turn off the "DAC Census Tracts" layer. Click the rain drop
            above the histogram to apply the color style. Now only eligible
            sites located in a census tract with a CalEnviroscreen score
            between 75 and 100 are available and colored gradiently by score.
            Using additional filters will further refine your
            selected sites.</li>
        </ol>
        <p>To undo this step, click "Clear" within the CalEnviroscreen 3.0
          Scores filter. Click the raindrop to undo the color style.</p>
        <img src="images/dac.gif">

      </div>

      <button class="accordion">Find sites where the most people's usage could be offset by solar PV</button>
      <div class="panel">

        <ol>
          <li>Scroll down to the "Local Population Offset" filter and open it.
          </li>
          <li>A histogram shows the distribution of a low estimate of population where total
            electricity usage could be offset by solar PV within the census block group
            where the eligible site is located.</li>
          <li>Click on the histogram and two range bars appear. Drag the bars
            to capture the highest range of population or the range you are
            most interested in.</li>
          <li>Now, only eligible sites with the highest number of people whose electricity usage
            could by offset by solar PV within the range you have selected are visible on the map.
            Using additional filters will further refine your selected sites.</li>
        </ol>
        <p>To undo this step, click "Clear" within the Local Population Offset
          filter. To see a histogram of just the sites you've selected, click
          "Zoom."</p>
        <img src="images/pop.gif">

      </div>

      <button class="accordion">Find sites where the most renter's usage could be offset by solar PV</button>
      <div class="panel">

        <ol>
          <li>Go to the legend on the left side of the map. Click the check
            box next to the "Housing Attribute Data" layer. This layer is
            provided as an overview of the percentage of renters in each
            census tract.</li>
          <li>Scroll to and open the "Local Renter Household Offset" filter.
            This filters eligible sites based on a low estimate of the population where total
            electricity usage could be offset by solar PV within the census block group
            where the eligible site is located.</li>
          <li>Click the histogram and two range bars appear. Drag the bars to
            capture the eligible sites within the highest range of percent
            renters.</li>
          <li>Now, only eligible sites with the highest number of renters whose electricity usage
            could by offset by solar PV within the range you have selected are visible on the map.
            Using additional filters will further refine your selected sites.</li>
        </ol>
        <p>To undo this step, click "Clear" within the Local Renter Household
          Offset filter. To see a histogram of just the sites you've
          selected, click "Zoom."</p>
        <img src="images/rent.gif">
        
      </div>

      <button class="accordion">Where are Brownfield and Superfund sites?</button>
      <div class="panel">

        <p>Brownfield and Superfund point locations are now included outside of the choice of layers.</p>
        <ol>
          <li>Zoom into any location within Los Angeles County on the map.</li>
          <li>Red and yellow points appear on the map labeled by the site name.
              <br/><b style="color:red">Red</b> represents Brownfield sites
              <br/><b style="color:#dddd21">Yellow</b> represents Superfund sites
          </li>
        </ol>
        <img src="images/brownfield.PNG">
        
      </div>

      </div>

      <button class="accordion">How do I single-out sites I'm interested in?</button>
      <div class="panel">

        <p>Our suggestion is to keep track of sites based on the Site ID number.</p>
        <ol>
          <li>You have found a site or multiple sites to consider.</li>
          <li>Click on the site to view the pop-up and locate Site ID, listed first.
              <br/>We suggest keeping a list of Site ID's for eligible sites you are considering.
          <li>To view only this site on the map, use the Site ID filter. </li>
          <li>Open the filter and search for the Site ID you are interested in. Multiple sites can be added with this filter.</li>
            <br/>Note that the filter will not zoom to the site automatically. You will need to know roughly where it is located and zoom in manually.
        </ol>
        
      </div>

      <button class="accordion">Download Data</button>
      <div class="panel">
        <p><b>Simplified Data</b></p>
        <p>Choose Excel for curated data columns matching what is available when you click 
          on an Eligible Site on the Map. Our suggestion, if you would like data for a 
          few sites, is to write down the Site ID value (found by clicking on
          a site on the map). Use the Excel file to match the Site ID(s) of interest. 
          This document includes metadata.
        </p>
        <p><b>Full Data Columns</b></p>
        <p>Choose CSV or Shapefile for the full columns of the Eligible Sites data layer available for download through CARTO.
        </p>
        <p>Metadata includes column names and descriptions.</p>
        
        <!-- TESTING EXCEL DOWNLOAD
        <button id="button-a">Create Excel</button> -->
        
        <div class="dropdown">
          <button onclick="dropFunction()"class="dropbtn">Download Eligible Sites Data as:</button>
          <div id="myDropdown" class="dropdown-content">
            <!-- <a href="download/institutional_sites.xlsx" download="institutional_sites">Excel (simplified with metadata)</a> -->
            <a href="excel.html" target="_blank">Excel (simplified with metadata)</a>
            <a href="https://ccsc-ucla.carto.com/tables/institutional_sites/public/map" target="_blank">CSV (full data)</a>
            <a href="https://ccsc-ucla.carto.com/tables/institutional_sites/public/map" target="_blank">Shapefile (full data)</a>
            <a href="download/institutional_sites_metadata.xlsx" download="institutional_sites_metadata">Download Full Metadata</a>
          </div>
        </div>

      </div>



    </main>



    <iframe class="map-wrapper" id="map"
      src="https://ccsc-ucla.carto.com/builder/d02c9204-891a-440a-b021-7df2ebcdb976/embed"
      allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen
      msallowfullscreen title="Solar Tool Carto Map"></iframe>

    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/scripts.js"></script>
    <!-- <script>
      var wb = XLSX.utils.book_new();
      wb.Props = {
              Title: "SheetJS Tutorial",
              Subject: "Test",
              Author: "Red Stapler",
              CreatedDate: new Date(2017,12,19)
      };
      
      wb.SheetNames.push("Test Sheet");
      //var ws_data = [['hello' , 'world']];
      //var ws = XLSX.utils.aoa_to_sheet(ws_data);
      
      const api_url = 'https://ccsc-ucla.carto.com:443/api/v2/sql?q=select site_id, address, combined_solar_potential_low_mw, percent_15_cap, combined_solar_annual_output_low_mwh_ac, low_combined_res_usage_offset_capita, low_combined_res_usage_offset_owner_households, low_combined_res_usage_offset_renter_households, ciscorep, cpa_territory, circuit_name, sub_name, sys_name, rooftop_solar_potential_mw, parking_lot_solar_potential_low_mw, parking_lot_solar_annual_output_low_mwh_ac, rooftop_solar_annual_output_mwh_ac, total_res_usage_per_cap, total_res_usage_per_owner_household, total_res_usage_per_renter_household, average_household_size_owner_occupied_housing_units, average_household_size_renter_occupied_housing_units, vacancy_percentage, renter_percentage from public.institutional_sites'
      // let response = fetch(api_url);
      // let data = response.json();
      async function getSitesData() {
        const response = await fetch (api_url);
        const data = await response.json();
        console.log(data.rows)
        const ws = XLSX.utils.json_to_sheet(data.rows);
        wb.Sheets["Test Sheet"] = ws;
        var wbout = XLSX.write(wb, {bookType:'xlsx',  type: 'binary'});
        console.log(ws)

        var buf = new ArrayBuffer(wbout.length);
        var view = new Uint8Array(buf);
        for (var i=0; i<wbout.length; i++) view[i] = wbout.charCodeAt(i) & 0xFF;
        saveAs(new Blob([buf],{type:"application/octet-stream"}), 'test.xlsx')
      }
      getSitesData();

    </script> -->
  </body>

</html>
